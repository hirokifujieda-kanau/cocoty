# RPG診断機能 - 完全仕様書

**作成日**: 2026年1月19日  
**バージョン**: 2.0  
**目的**: RPG診断の質問、計算ロジック、因子マッピングの完全定義

---

## 📋 質問一覧（全15項目）

| ID | 列 | 質問文 | 因子 | 逆転項目 | 備考 |
|----|----|----|------|---------|------|
| 1 | R | 知らない人とすぐに会話ができる | fencer | ❌ | - |
| 2 | S | 人が快適で幸せかどうか、気になる | healer | ❌ | - |
| 3 | T | 絵画・映像・小説・音楽などの創作活動をしている | schemer | ❌ | - |
| 4 | U | 事前準備は、余裕を持って入念にする方だ | gunner | ❌ | - |
| 5 | V | 気分が落ち込んだり、憂うつになったりする | shielder | ❌ | - |
| 6 | W | パーティや交流イベントを企画するのが好き | fencer | ❌ | - |
| 7 | X | 人と議論を起こしやすい。批判をすることが得意 | healer | ✅ **逆転** | 6-score |
| 8 | Y | 哲学的、精神的なテーマを考えるのが好き | schemer | ❌ | - |
| 9 | Z | ものごとを整理して考えるのが苦手 | gunner | ✅ **逆転** | 6-score |
| 10 | AA | ストレスを感じたり、不安になったりする | shielder | ❌ | - |
| 11 | AB | カタカナ語や、むずかしい言葉を使うことが多い | schemer | ❌ | - |
| 12 | AC | 他の人の気持ちを思いやり、優先する | healer | ❌ | - |
| 13 | AD | 自分は、他の人よりも、チームに貢献したり、成果を出していると思う | **未使用** | ❌ | スコア計算に含まない |
| 14 | AE | 自分は、現在の職場や置かれた状況に満足している | **未使用** | ❌ | スコア計算に含まない |
| 15 | AF | 性別 | - | - | 共感本能の判定に使用 |

---

## 🧮 計算ロジック

### Step 1: 因子スコアの計算

各因子は複数の質問から算出されます。逆転項目は `6 - score` で変換します。

#### フェンサー因子（狩猟本能）
```
フェンサー因子 = Q1 + Q6
```
- Q1 (R): 知らない人とすぐに会話ができる
- Q6 (W): パーティや交流イベントを企画するのが好き

#### ヒーラー因子（共感本能）
```
ヒーラー因子 = Q2 + reverse(Q7) + Q12
```
- Q2 (S): 人が快適で幸せかどうか、気になる
- Q7 (X): 人と議論を起こしやすい。批判をすることが得意 **【逆転】**
- Q12 (AC): 他の人の気持ちを思いやり、優先する

**逆転処理:**
```
reverse(Q7) = 6 - Q7の回答値
例: Q7で「1」を選択 → 6 - 1 = 5点
    Q7で「5」を選択 → 6 - 5 = 1点
```

#### スキーマー因子（飛躍本能）
```
スキーマー因子 = Q3 + Q8 + Q11
```
- Q3 (T): 絵画・映像・小説・音楽などの創作活動をしている
- Q8 (Y): 哲学的、精神的なテーマを考えるのが好き
- Q11 (AB): カタカナ語や、むずかしい言葉を使うことが多い

#### ガンナー因子（職人魂）
```
ガンナー因子 = Q4 + reverse(Q9)
```
- Q4 (U): 事前準備は、余裕を持って入念にする方だ
- Q9 (Z): ものごとを整理して考えるのが苦手 **【逆転】**

**逆転処理:**
```
reverse(Q9) = 6 - Q9の回答値
```

#### シールダー因子（警戒本能）
```
シールダー因子 = Q5 + Q10
```
- Q5 (V): 気分が落ち込んだり、憂うつになったりする
- Q10 (AA): ストレスを感じたり、不安になったりする

---

### Step 2: 因子スコアから本能レベルへの変換

因子スコアを1〜4の本能レベルに変換します。

#### 狩猟本能（フェンサー因子）
| 因子スコア | 本能レベル |
|----------|----------|
| 9以上 | 4 |
| 7〜8 | 3 |
| 5〜6 | 2 |
| 4以下 | 1 |

```typescript
if (fencerScore >= 9) return 4;
if (fencerScore >= 7) return 3;
if (fencerScore >= 5) return 2;
return 1;
```

#### 共感本能（ヒーラー因子）- **性別で基準が異なる**

**男性の場合:**
| 因子スコア | 本能レベル |
|----------|----------|
| 14以上 | 4 |
| 12〜13 | 3 |
| 10〜11 | 2 |
| 9以下 | 1 |

**女性の場合:**
| 因子スコア | 本能レベル |
|----------|----------|
| 15以上 | 4 |
| 14 | 3 |
| 12〜13 | 2 |
| 11以下 | 1 |

```typescript
if (gender === '男性') {
  if (healerScore >= 14) return 4;
  if (healerScore >= 12) return 3;
  if (healerScore >= 10) return 2;
  return 1;
} else { // 女性
  if (healerScore >= 15) return 4;
  if (healerScore >= 14) return 3;
  if (healerScore >= 12) return 2;
  return 1;
}
```

#### 飛躍本能（スキーマー因子）
| 因子スコア | 本能レベル |
|----------|----------|
| 13以上 | 4 |
| 11〜12 | 3 |
| 9〜10 | 2 |
| 8以下 | 1 |

```typescript
if (schemerScore >= 13) return 4;
if (schemerScore >= 11) return 3;
if (schemerScore >= 9) return 2;
return 1;
```

#### 職人魂（ガンナー因子）
| 因子スコア | 本能レベル |
|----------|----------|
| 9以上 | 4 |
| 7〜8 | 3 |
| 5〜6 | 2 |
| 4以下 | 1 |

```typescript
if (gunnerScore >= 9) return 4;
if (gunnerScore >= 7) return 3;
if (gunnerScore >= 5) return 2;
return 1;
```

#### 警戒本能（シールダー因子）
| 因子スコア | 本能レベル |
|----------|----------|
| 9以上 | 4 |
| 7〜8 | 3 |
| 5〜6 | 2 |
| 4以下 | 1 |

```typescript
if (shielderScore >= 9) return 4;
if (shielderScore >= 7) return 3;
if (shielderScore >= 5) return 2;
return 1;
```

---

## 📊 因子と本能の対応表

| 因子名（英語） | 因子名（日本語） | 本能名 | 素質名 | DB列名 | 質問数 | 使用する質問 |
|---------------|----------------|--------|--------|--------|-------|-------------|
| **fencer** | フェンサー因子 | 狩猟本能 | フェンサー素質 | rpg_fencer | 2 | Q1, Q6 |
| **healer** | ヒーラー因子 | 共感本能 | ヒーラー素質 | rpg_healer | 3 | Q2, Q7(逆), Q12 |
| **schemer** | スキーマー因子 | 飛躍本能 | スキーマー素質 | rpg_schemer | 3 | Q3, Q8, Q11 |
| **gunner** | ガンナー因子 | 職人魂 | ガンナー素質 | rpg_gunner | 2 | Q4, Q9(逆) |
| **shielder** | シールダー因子 | 警戒本能 | シールダー素質 | rpg_shielder | 2 | Q5, Q10 |

---

## 🎯 各本能の詳細説明

### 狩猟本能（フェンサー素質）⚔️
**定義**: 積極的に行動し、新しい人や環境に飛び込む力

| レベル | 特徴 |
|-------|------|
| **高い人** | 社交的・物事に熱中する |
| **利点** | 金銭・快楽の成功を得やすい → 行動が積極的 |
| **コスト** | 波乱万丈、家庭的な安定欠如 |
| **低い人** | よそよそしい・物静か |
| **利点** | 浮動性が低く安定・熟慮できる |
| **コスト** | チャンスを逃しがち |

---

### 共感本能（ヒーラー素質）💚
**定義**: 他者の感情を理解し、思いやる力

| レベル | 特徴 |
|-------|------|
| **高い人** | 人を信頼する・共感できる |
| **利点** | 社会で良い人間関係を築ける |
| **コスト** | 自己犠牲で損をする・出世しにくい |
| **低い人** | 非協力的・自己中心的 |
| **利点** | 周りに振り回されず集中できる |
| **コスト** | 孤立無援になりがち |

---

### 飛躍本能（スキーマー素質）🎨
**定義**: 創造的に発想し、新しいアイデアを生み出す力

| レベル | 特徴 |
|-------|------|
| **高い人** | 独創的・創造力に富む・エキセントリック |
| **利点** | 芸術的感受性、拡散的思考 |
| **コスト** | 異常な信念、精神病傾向 |
| **低い人** | 冒険しない・先例主義 |
| **利点** | 現実思考で着実 |
| **コスト** | 陳腐化・埋没しがち |

---

### 職人魂（ガンナー素質）🔧
**定義**: 計画的に準備し、丁寧に物事を仕上げる力

| レベル | 特徴 |
|-------|------|
| **高い人** | 有能・自己管理できる |
| **利点** | 組織内での成功、自己抑制 |
| **コスト** | 融通のなさ、変化にストレス |
| **低い人** | 衝動的・不注意な行動 |
| **利点** | 臨機応変 |
| **コスト** | 自制できない・破滅的 |

---

### 警戒本能（シールダー素質）🛡️
**定義**: リスクを察知し、慎重に判断する力

| レベル | 特徴 |
|-------|------|
| **高い人** | 危機察知性が高く、高ストレス・心配性の傾向 |
| **利点** | ミスを回避、事前努力が苦なくできる |
| **コスト** | 不安症・うつになりやすい |
| **低い人** | 情緒的に安定 |
| **利点** | プレッシャーに強い |
| **コスト** | リスクを冒しすぎる |

---

## 💾 データベース設計

### rpg_questions テーブル

| カラム名 | 型 | 説明 | 例 |
|---------|-----|------|-----|
| id | integer | 質問ID | 1, 2, 3... |
| text | text | 質問文 | "知らない人とすぐに会話ができる" |
| factor | string | 因子名 | "fencer", "healer", "schemer", "gunner", "shielder" |
| is_reversed | boolean | 逆転項目か | false / true |
| order | integer | 表示順序 | 1〜15 |
| active | boolean | 有効フラグ | true / false |

**注意:**
- Q13とQ14は `active: false` で保存（将来的に使用する可能性あり）
- Q15（性別）は別テーブル（profilesのgenderカラム）で管理

### profiles テーブル（拡張）

診断結果を保存するカラム:

| カラム名 | 型 | 説明 | 値の範囲 |
|---------|-----|------|---------|
| rpg_fencer | integer | 狩猟本能のレベル | 1〜4 |
| rpg_healer | integer | 共感本能のレベル | 1〜4 |
| rpg_schemer | integer | 飛躍本能のレベル | 1〜4 |
| rpg_gunner | integer | 職人魂のレベル | 1〜4 |
| rpg_shielder | integer | 警戒本能のレベル | 1〜4 |
| rpg_diagnosed_at | datetime | 診断実施日時 | - |
| gender | string | 性別 | "男性" / "女性" |

---

## 🔄 計算フロー全体像

```
ユーザー回答（Q1〜Q12）
    ↓
逆転項目の処理（Q7, Q9）
    ↓
因子スコア計算
  - フェンサー因子 = Q1 + Q6
  - ヒーラー因子 = Q2 + reverse(Q7) + Q12
  - スキーマー因子 = Q3 + Q8 + Q11
  - ガンナー因子 = Q4 + reverse(Q9)
  - シールダー因子 = Q5 + Q10
    ↓
本能レベル判定（1〜4）
  - 性別を考慮（ヒーラー因子のみ）
  - 因子スコアから本能レベルへ変換
    ↓
結果保存（DB: profiles）
```

---

## ⚠️ 重要な実装ポイント

### 1. 逆転項目の処理
- **Q7（人と議論を起こしやすい。批判をすることが得意）**: `6 - score`
- **Q9（ものごとを整理して考えるのが苦手）**: `6 - score`

### 2. 性別による判定基準の違い
- **共感本能（ヒーラー）のみ**、男性と女性で基準が異なる
- プロフィールの `gender` カラムを参照

### 3. 未使用の質問
- **Q13**: チームへの貢献度（将来的に使用予定）
- **Q14**: 現在の満足度（将来的に使用予定）
- データベースには保存するが、`active: false` で非表示

### 4. 回答スケール
- 1〜5の5段階評価を想定
- 1: 全く当てはまらない
- 5: 非常に当てはまる

---

## 📝 実装チェックリスト

### フロントエンド
- [ ] 質問12問を表示（Q1〜Q12）
- [ ] 性別選択UI（Q15）
- [ ] 逆転項目の計算処理（Q7, Q9）
- [ ] 因子スコア計算ロジック
- [ ] 性別に応じたヒーラー本能判定
- [ ] 本能レベルへの変換
- [ ] 結果保存API呼び出し

### バックエンド
- [ ] rpg_questionsテーブル作成
- [ ] 12問のマスターデータ投入（Q1〜Q12）
- [ ] Q13, Q14を `active: false` で保存
- [ ] 質問一覧取得API（active: true のみ）
- [ ] 診断結果保存API
- [ ] 性別カラムの確認

---

以上、RPG診断機能の完全仕様です。

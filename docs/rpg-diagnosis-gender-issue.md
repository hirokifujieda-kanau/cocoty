# RPG診断：性別問題と対応方針

## 現状の問題

### 1. 性別データがない
- **フロントエンド**: 性別選択UIなし
- **バックエンド**: profilesテーブルにgenderカラムなし
- **計算ロジック**: デフォルト「男性」で共感本能を計算

### 2. 影響範囲

#### 共感本能（Healer）の計算
```typescript
// 女性の場合、ボーナス判定が甘くなる
const healerLevel = calculateHealerLevel(healerScore, gender);

// 男性: 13点以上でレベル4
// 女性: 11点以上でレベル4
```

**問題**: 現在すべてのユーザーが「男性」として計算される

## 対応方針

### ✅ 短期対応（今すぐ）
性別情報なしで診断を正確に動作させる

#### オプション1: 性別選択なしで診断（推奨）
- 中性的な閾値を使用
- すべてのユーザーに公平な計算

```typescript
// 男女の中間値を使用
const HEALER_THRESHOLDS = [0, 6, 9, 12, 15]; // レベル1-4
```

#### オプション2: 診断開始時に性別を選択
- UIで性別選択（保存はしない）
- その場限りの計算用

### 🔧 中期対応（1-2週間）
性別カラムをバックエンドに追加

1. マイグレーション作成
```ruby
add_column :profiles, :gender, :string
```

2. プロフィール編集画面に性別選択追加

3. RPG診断で性別を参照

## タロット占いの質問への回答

### 画像とテキストの提供形式

**現在の実装**: 
- バックエンドAPI: `/api/v1/tarot_cards`
- データ構造:
```json
{
  "id": 1,
  "name": "愚者",
  "name_en": "The Fool",
  "meaning": "新しい始まり、自由、冒険",
  "reverse_meaning": "無謀、軽率、方向性の喪失",
  "description": "...",
  "image_url": "https://..."
}
```

**推奨画像サイズ**:
- **縦横比**: 2:3 (タロットカード標準)
- **推奨サイズ**: 600x900px (高解像度)
- **最小サイズ**: 300x450px
- **フォーマット**: WebP（軽量）または PNG（透過対応）
- **ファイルサイズ**: 100KB以下（表示速度のため）

**カード裏面**（選択前に表示）:
- サイズ: 600x900px
- デザイン: 統一された裏面デザイン1枚
- ファイル名例: `tarot-back.webp`

**カード表面**（78枚）:
- 大アルカナ: 22枚（0-21）
- 小アルカナ: 56枚（各スート14枚×4）
- ファイル名例: `00-fool.webp`, `01-magician.webp`

### 提供方法

#### オプションA: Cloudinaryにアップロード
```typescript
image_url: "https://res.cloudinary.com/your-cloud/image/upload/v1234/tarot/00-fool.webp"
```

#### オプションB: public/tarot/ フォルダに配置
```typescript
image_url: "/tarot/00-fool.webp"
```

推奨: **オプションA（Cloudinary）**
- 理由: 自動最適化、レスポンシブ、CDN配信

## 診断結果表示の実装

### 必要な機能

1. **自分のプロフィール**
   - RPG診断結果を表示
   - 「診断する」ボタン（未診断時）
   - 「再診断する」ボタン（診断済み時）

2. **他人のプロフィール**
   - RPG診断結果を表示（診断済みの場合）
   - 診断ボタンなし（編集不可）

3. **タロット占い**
   - 自分: 占える
   - 他人: 結果のみ表示（当日引いた場合）、占えない

## 実装優先順位

1. ✅ **性別なしで正確な計算**（今すぐ）
2. ✅ **プロフィールページに診断結果表示**（今すぐ）
3. ✅ **他人のプロフィールは編集不可**（今すぐ）
4. ⏳ 性別カラム追加（中期）
5. ⏳ タロット画像の実装（画像準備後）

# ğŸ“ æ–°è¦ç™»éŒ²APIä»•æ§˜æ›¸

## ğŸ”„ æ–°ã—ã„ç™»éŒ²ãƒ•ãƒ­ãƒ¼ï¼ˆ2025å¹´12æœˆ22æ—¥æ›´æ–°ï¼‰

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```
POST /api/v1/auth/setup_profile
```

### é‡è¦ãªå¤‰æ›´ç‚¹
- âš ï¸ **Firebaseã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã—ãŸã ã‘ã§ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯ä½œã‚‰ã‚Œã¾ã›ã‚“**
- âœ… **å¿…ãš `setup_profile` APIã‚’å‘¼ã‚“ã§ãã ã•ã„**
- âŒ æ—¢ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒã‚ã‚‹å ´åˆã¯422ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚Šã¾ã™

---

## ğŸ“‹ å®Ÿè£…æ‰‹é †

### 1. Firebaseç™»éŒ²
```typescript
const user = await signUp(email, password);
```

### 2. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆAPIã‚’å‘¼ã¶ï¼ˆå¿…é ˆï¼‰
```typescript
await apiRequest('/auth/setup_profile', {
  method: 'POST',
  requireAuth: true,
  body: JSON.stringify({
    profile: {
      name: "è—¤æ",           // å¿…é ˆ
      nickname: "è—¤æ",       // ä»»æ„ï¼ˆçœç•¥æ™‚ã¯nameã®æœ€åˆã®å˜èªï¼‰
      birthday: "1999-01-01"  // å¿…é ˆï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
    }
  })
});
```

### 3. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```typescript
router.push('/profile');
```

---

## ğŸ¯ ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚¤ãƒ— | å¿…é ˆ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
|-----------|--------|------|---------------|
| **åå‰** | `<input type="text">` | âœ… Yes | ç©ºç™½ä¸å¯ |
| **ç”Ÿå¹´æœˆæ—¥** | å¹´æœˆæ—¥ã®3ã¤ã®å…¥åŠ› | âœ… Yes | YYYY-MM-DDå½¢å¼ã«å¤‰æ› |
| **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹** | `<input type="email">` | âœ… Yes | ãƒ¡ãƒ¼ãƒ«å½¢å¼ |
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰** | `<input type="password">` | âœ… Yes | 8æ–‡å­—ä»¥ä¸Šã€è‹±æ•°å­—æ··åˆ |

---

## ğŸ’» SignupPageå®Ÿè£…ä¾‹

```typescript
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  
  try {
    // 1. Firebaseèªè¨¼
    await signup(formData.email, formData.password);
    
    // 2. ç”Ÿå¹´æœˆæ—¥ã‚’YYYY-MM-DDå½¢å¼ã«å¤‰æ›
    const birthday = `${formData.year}-${formData.month.padStart(2, '0')}-${formData.day.padStart(2, '0')}`;
    
    // 3. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆAPI
    await apiRequest('/auth/setup_profile', {
      method: 'POST',
      requireAuth: true,
      body: JSON.stringify({
        profile: {
          name: formData.name.trim(),
          nickname: formData.name.trim(),
          birthday: birthday
        }
      })
    });
    
    // 4. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    router.push('/profile');
  } catch (err: any) {
    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    if (err.message && err.message.includes('422')) {
      setError('æ—¢ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
    } else {
      setError(err.message);
    }
  }
};
```

---

## âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Firebaseã‚¨ãƒ©ãƒ¼
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | æ„å‘³ | æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|-------------|------|----------------|
| `auth/email-already-in-use` | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡ | ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ |
| `auth/invalid-email` | ãƒ¡ãƒ¼ãƒ«å½¢å¼ä¸æ­£ | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ |
| `auth/weak-password` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã„ | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„ |
| `auth/operation-not-allowed` | æ“ä½œãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„ | ã“ã®æ“ä½œã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ |

### APIã‚¨ãƒ©ãƒ¼
| HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ„å‘³ | æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|---------------|------|----------------|
| `422 Unprocessable Entity` | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ—¢å­˜ | æ—¢ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚ |
| `401 Unauthorized` | èªè¨¼ã‚¨ãƒ©ãƒ¼ | èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚ |
| `500 Internal Server Error` | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ |

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ‰‹é †

### 1. æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ
```bash
# æ–°è¦ç™»éŒ²ãƒšãƒ¼ã‚¸ã‚’é–‹ã
open http://localhost:3000/signup

# å…¥åŠ›
åå‰: è—¤æ
ç”Ÿå¹´æœˆæ—¥: 1999å¹´1æœˆ1æ—¥
ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: test@example.com
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: password123

# æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ
âœ… Firebaseèªè¨¼æˆåŠŸ
âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆæˆåŠŸ
âœ… /profile ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«åå‰ã¨ç”Ÿå¹´æœˆæ—¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

### 2. ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆ1: åå‰ãŒç©º**
```
å…¥åŠ›: åå‰ã‚’ç©ºç™½ã«ã™ã‚‹
æœŸå¾…çµæœ: "åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
```

**ãƒ†ã‚¹ãƒˆ2: ç”Ÿå¹´æœˆæ—¥ãŒæœªå…¥åŠ›**
```
å…¥åŠ›: å¹´æœˆæ—¥ã®ã„ãšã‚Œã‹ã‚’ç©ºç™½ã«ã™ã‚‹
æœŸå¾…çµæœ: "ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
```

**ãƒ†ã‚¹ãƒˆ3: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡**
```
å…¥åŠ›: æ—¢ã«ç™»éŒ²æ¸ˆã¿ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
æœŸå¾…çµæœ: "ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™" ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
```

**ãƒ†ã‚¹ãƒˆ4: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã„**
```
å…¥åŠ›: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ "test" ï¼ˆçŸ­ã™ãã‚‹ï¼‰
æœŸå¾…çµæœ: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„" ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
```

**ãƒ†ã‚¹ãƒˆ5: åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§2å›signup**
```
æ“ä½œ: 
1. ä¸€åº¦signupæˆåŠŸ
2. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
3. Firebaseèªè¨¼ç”»é¢ã‹ã‚‰åŒã˜ãƒ¡ãƒ¼ãƒ«ã§å†ç™»éŒ²
4. setup_profile APIã‚’å†åº¦å‘¼ã¶

æœŸå¾…çµæœ: "æ—¢ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚" ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
```

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§ç¢ºèª
```typescript
console.log('ğŸ” Firebaseã§æ–°è¦ç™»éŒ²ä¸­:', formData.email);
console.log('âœ… Firebaseèªè¨¼æˆåŠŸï¼');
console.log('ğŸ’¾ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆä¸­...');
console.log('âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆæˆåŠŸï¼');
```

### Railså´ã§ç¢ºèª
```bash
# Railsã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã
rails console

# æœ€å¾Œã«ä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼
User.last
# => #<User id: 1, email: "test@example.com", firebase_uid: "xxxxx">

# ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç¢ºèª
User.last.profile
# => #<Profile id: 1, name: "è—¤æ", birthday: "1999-01-01">
```

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ç¢ºèª
```
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ï¼‰
2. Networkã‚¿ãƒ–ã«ç§»å‹•
3. ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. POST /api/v1/auth/setup_profile ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª

ã€ç¢ºèªãƒã‚¤ãƒ³ãƒˆã€‘
- Request Headers ã« Authorization: Bearer {token} ãŒã‚ã‚‹ã‹
- Request Body ã« profile: { name, birthday } ãŒã‚ã‚‹ã‹
- Response Status ãŒ 200 ã‹ 422 ã‹
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 

### Users ãƒ†ãƒ¼ãƒ–ãƒ«
```ruby
create_table "users", force: :cascade do |t|
  t.string "email", null: false
  t.string "firebase_uid", null: false
  t.datetime "created_at", precision: 6, null: false
  t.datetime "updated_at", precision: 6, null: false
  t.index ["email"], name: "index_users_on_email", unique: true
  t.index ["firebase_uid"], name: "index_users_on_firebase_uid", unique: true
end
```

### Profiles ãƒ†ãƒ¼ãƒ–ãƒ«
```ruby
create_table "profiles", force: :cascade do |t|
  t.integer "user_id", null: false
  t.string "name", null: false
  t.string "nickname"
  t.date "birthday", null: false
  t.datetime "created_at", precision: 6, null: false
  t.datetime "updated_at", precision: 6, null: false
  t.index ["user_id"], name: "index_profiles_on_user_id", unique: true
end
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- [x] `apiRequest` ã‚’ export
- [x] SignupPage ã« `name` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [x] SignupPage ã« `birthday` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆå¹´æœˆæ—¥ï¼‰
- [x] `name` ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- [x] `birthday` ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- [x] `setup_profile` APIå‘¼ã³å‡ºã—å®Ÿè£…
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆ422ã‚¨ãƒ©ãƒ¼å¯¾å¿œï¼‰
- [x] ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°è¿½åŠ 

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…
- [ ] `POST /api/v1/auth/setup_profile` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ
- [ ] Firebase ID ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
- [ ] User ã¨ Profile ã®ä½œæˆå‡¦ç†
- [ ] æ—¢å­˜ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆ422ã‚¨ãƒ©ãƒ¼è¿”å´ï¼‰
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆname, birthdayå¿…é ˆï¼‰

---

## ğŸ‰ å®Œäº†ï¼

æ–°ã—ã„ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

**ä¸»ãªå¤‰æ›´ç‚¹:**
- âœ… Firebaseèªè¨¼å¾Œã€å³åº§ã« `setup_profile` APIã‚’å‘¼ã¶
- âœ… åå‰ã¨ç”Ÿå¹´æœˆæ—¥ãŒå¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«
- âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®è‡ªå‹•ä½œæˆã§ã¯ãªãã€æ˜ç¤ºçš„ãªä½œæˆã«å¤‰æ›´
- âœ… 422ã‚¨ãƒ©ãƒ¼ã§æ—¢å­˜ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ¤œå‡º

ãƒ†ã‚¹ãƒˆã—ã¦å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ğŸš€

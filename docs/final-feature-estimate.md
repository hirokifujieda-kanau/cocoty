# 最終機能一覧と工数見積もり

## 概要

プロフィール拡充の値入力機能（編集・設定）および認証システムを含めた、統合的な機能一覧と工数見積もりです。

---

## 📋 最終機能一覧（5機能）

### ① 認証 & プロフィール管理システム
ユーザー登録、ログイン、プロフィール編集、設定管理を含む基盤機能

### ② タロット・診断機能
ユーザーの性格診断、チーム適性診断、結果の保存・共有

### ③ タスク管理機能
個人タスクとチームタスクの管理、進捗追跡、完了記録

### ④ タグ共通者一覧機能
タグ検索により、同じ興味・スキルを持つメンバーを発見

### ⑤ チームプロジェクト画像表示
チームプロジェクトの曼荼羅アート画像を表示（アップロード機能は後フェーズ）

---

## 🎯 機能① 認証 & プロフィール管理システム

### フロントエンド実装状況（完了）

#### 認証機能（完了：~200行）
- ✅ **LoginPage.tsx** (202行)
  - メール・パスワードログインフォーム
  - SNSログインボタン（Google, Facebook, Twitter）
  - パスワード表示/非表示切替
  - Remember me チェックボックス
  - パスワードリセットリンク
  - 新規登録リンク

- ✅ **SignupPage.tsx** (264行)
  - 新規登録フォーム（名前、メール、パスワード、パスワード確認）
  - 利用規約同意チェックボックス
  - SNS登録ボタン
  - バリデーション（パスワード一致確認）
  - ログイン画面への遷移

- ✅ **UserSwitcher.tsx**
  - ユーザー切り替えドロップダウン
  - ログアウトボタン
  - プロフィール画面へのナビゲーション

- ✅ **AuthContext.tsx**
  - `login(userId)` 関数
  - `logout()` 関数
  - `currentUser` 状態管理
  - localStorage によるセッション永続化

#### プロフィール管理機能（完了：~967行）

- ✅ **ProfileEditModal.tsx** (301行)
  - **基本情報**: 名前、自己紹介、メール、電話、ウェブサイト、場所
  - **拡張情報**:
    - 誕生日（日付ピッカー）
    - 出身地（テキスト入力）
    - 趣味（カンマ区切り入力）
    - 好きな食べ物（カンマ区切り入力）
    - MBTIタイプ（16タイプドロップダウン）
    - 血液型（A/B/O/AB ドロップダウン）
  - アバター画像アップロードUI
  - カバー画像アップロードUI
  - 保存・キャンセルボタン

- ✅ **ProfileSettings.tsx** (666行)
  - **アカウントタブ**:
    - 基本情報編集
    - プロフィール画像更新
    - 連絡先情報
  
  - **プライバシータブ**:
    - `profileVisibility` (public/friends/private)
    - `activityVisibility` (表示/非表示)
    - `allowTagging` (タグ付け許可)
    - `allowMessaging` (メッセージ許可)
    - `showOnlineStatus` (オンライン状態表示)
    - `allowComments` (コメント許可)
  
  - **通知タブ**:
    - メール通知（いいね、コメント、メッセージ、イベント）
    - プッシュ通知（いいね、コメント、メッセージ、イベント）
    - ニュースレター購読
  
  - **セキュリティタブ**:
    - パスワード変更フォーム
    - 2要素認証トグル
    - アクティブセッション一覧
    - アカウント削除

- ✅ **InstagramProfilePage.tsx** (1057行)
  - 拡張プロフィールバッジ表示:
    - 🎂 年齢バッジ
    - 📍 出身地バッジ
    - 🩸 血液型バッジ
    - 🧠 MBTIバッジ
    - 趣味タグ（オレンジ）
    - 好きな食べ物タグ（ピンク）
  - 編集ボタン → ProfileEditModal
  - 設定ボタン → ProfileSettings

#### モックバックエンド（完了）

- ✅ **mockAuth.ts** (321行)
  - `login(userId)` - ユーザーログイン
  - `logout()` - ログアウト
  - `getCurrentUser()` - 現在のユーザー取得
  - `initializeSession()` - セッション復元
  - 20人分のモックユーザー（user_001 ～ user_020）

- ✅ **mockUserSettings.ts**
  - `getUserSettings(userId)` - 設定取得
  - `updateAccountInfo(userId, data)` - 基本情報更新
  - `updatePrivacySettings(userId, settings)` - プライバシー設定更新
  - `updateNotificationSettings(userId, settings)` - 通知設定更新
  - `updateSecuritySettings(userId, settings)` - セキュリティ設定更新
  - `changePassword(userId, current, new)` - パスワード変更
  - `deleteAccount(userId, password)` - アカウント削除

- ✅ **dummyUsers.ts**
  - 20人分の詳細ユーザープロフィール
  - 拡張プロフィールデータ:
    - birthday, age, birthplace
    - hobbies: string[]
    - favoriteFood: string[]
    - mbtiType, bloodType

### バックエンド実装必要項目

#### 1. 認証API

| 項目 | 内容 | 工数 |
|------|------|------|
| ユーザー登録API | メール・パスワード登録、バリデーション、パスワードハッシュ化 | 12h |
| ログインAPI | 認証、JWT/セッショントークン発行、リフレッシュトークン | 10h |
| ログアウトAPI | セッション無効化、トークン削除 | 2h |
| パスワードリセット | メール送信、トークン生成、パスワード更新 | 8h |
| OAuth連携 | Google, Facebook, Twitter 連携 | 16h |
| セッション管理 | Redis/DB でのセッション保存、有効期限管理 | 8h |
| 2要素認証(2FA) | TOTP実装、QRコード生成、検証 | 12h |
| **小計** | | **68h** |

#### 2. プロフィール管理API

| 項目 | 内容 | 工数 |
|------|------|------|
| プロフィール取得API | ユーザー情報、拡張フィールド取得 | 4h |
| プロフィール更新API | 基本情報、拡張情報の更新 | 8h |
| 画像アップロードAPI | アバター、カバー画像のS3アップロード、リサイズ | 10h |
| 拡張フィールド保存 | 配列型フィールド（hobbies, favoriteFood）の保存・取得 | 6h |
| タグ連携 | hobbies/favoriteFood をグローバルタグシステムと同期 | 8h |
| **小計** | | **36h** |

#### 3. 設定管理API

| 項目 | 内容 | 工数 |
|------|------|------|
| 設定取得API | プライバシー、通知、セキュリティ設定取得 | 4h |
| プライバシー設定API | 公開範囲、タグ付け許可などの更新 | 6h |
| 通知設定API | メール・プッシュ通知の設定更新 | 6h |
| セキュリティ設定API | パスワード変更、2FA設定、セッション管理 | 10h |
| アカウント削除API | 論理削除、関連データの処理 | 8h |
| **小計** | | **34h** |

#### 4. データベース設計

| 項目 | 内容 | 工数 |
|------|------|------|
| Usersテーブル | id, email, password_hash, name, nickname, avatar, cover_image, bio, birthday, age, birthplace, mbti_type, blood_type, created_at, updated_at | 4h |
| UserHobbiesテーブル | user_id, hobby (配列または関連テーブル) | 3h |
| UserFavoriteFoodsテーブル | user_id, food (配列または関連テーブル) | 3h |
| UserSettingsテーブル | user_id, privacy_settings (JSON), notification_settings (JSON), security_settings (JSON) | 4h |
| Sessionsテーブル | session_id, user_id, token, expires_at, device_info | 3h |
| OAuthAccountsテーブル | user_id, provider, provider_user_id, access_token, refresh_token | 4h |
| マイグレーション作成 | 全テーブルのマイグレーション | 5h |
| **小計** | | **26h** |

#### 5. インフラ・環境構築

| 項目 | 内容 | 工数 |
|------|------|------|
| 環境変数設定 | JWT秘密鍵、OAuth クライアントID/シークレット | 2h |
| S3バケット設定 | 画像アップロード用バケット、CORS設定 | 4h |
| Redis設定 | セッション保存用Redisの構築 | 4h |
| メール送信設定 | SendGrid/SES でのメール送信設定 | 4h |
| セキュリティ設定 | Rate limiting, CSRF保護、XSS対策 | 6h |
| **小計** | | **20h** |

#### 6. テスト

| 項目 | 内容 | 工数 |
|------|------|------|
| ユニットテスト | 認証ロジック、バリデーション、パスワードハッシュ | 12h |
| 統合テスト | API エンドポイント、DB連携 | 12h |
| E2Eテスト | ログイン～プロフィール編集～ログアウトフロー | 8h |
| セキュリティテスト | 脆弱性スキャン、ペネトレーションテスト | 8h |
| **小計** | | **40h** |

### 機能① 合計工数

| カテゴリ | 工数 |
|----------|------|
| **フロントエンド** | **0h** (完了済み) |
| **バックエンドAPI** | **138h** (認証68h + プロフィール36h + 設定34h) |
| **データベース** | **26h** |
| **インフラ** | **20h** |
| **テスト** | **40h** |
| **合計** | **224h** |

### データ整合性の確保

#### プロフィールデータフロー
```
フロントエンド                バックエンド                データベース
├─ hobbies: string[]  →  ├─ POST /api/profile  →  ├─ UserHobbies テーブル
├─ favoriteFood: string[] →  ├─ 配列を保存        →  ├─ 配列またはJOIN
└─ タグ表示（バッジ）     └─ グローバルタグと同期  └─ Tags テーブルと連携
```

#### タグシステムとの連携
- **趣味（hobbies）** と **好きな食べ物（favoriteFood）** はグローバルタグシステムと同期
- プロフィール編集時、新しいタグは自動的にグローバルタグに追加
- タグ検索機能で同じ趣味・好きな食べ物を持つユーザーを発見可能

---

## 🎴 機能② タロット・診断機能

### フロントエンド実装状況
- ✅ タロットカードUI（一部実装済み）
- ❌ 診断結果表示（未実装）
- ❌ 結果保存・共有機能（未実装）

### バックエンド実装必要項目

| 項目 | 内容 | 工数 |
|------|------|------|
| 診断ロジックAPI | 質問に基づく診断アルゴリズム | 16h |
| 診断結果保存API | ユーザーの診断結果をDB保存 | 8h |
| 診断履歴取得API | 過去の診断結果一覧取得 | 6h |
| チーム適性診断 | チームメンバーとの相性診断 | 12h |
| 結果共有機能 | SNS共有、リンク生成 | 8h |
| データベース設計 | DiagnosisResultsテーブル、質問・回答マスター | 6h |
| テスト | ユニット、統合、E2E | 16h |
| **フロントエンド追加実装** | 診断結果UI、履歴表示、共有UI | **32h** |
| **合計** | | **104h** |

---

## ✅ 機能③ タスク管理機能

### フロントエンド実装状況
- ❌ タスク一覧（未実装）
- ❌ タスク作成・編集（未実装）
- ❌ 進捗管理（未実装）

### バックエンド実装必要項目

| 項目 | 内容 | 工数 |
|------|------|------|
| タスクCRUD API | 作成、取得、更新、削除 | 12h |
| タスク一覧取得 | フィルタ（ステータス、期限、担当者）、ソート | 8h |
| タスク割り当て | チームメンバーへの割り当て | 6h |
| 進捗管理 | ステータス更新、完了率計算 | 8h |
| 通知機能 | 期限前通知、アサイン通知 | 10h |
| データベース設計 | Tasksテーブル、TaskAssignmentsテーブル | 6h |
| テスト | ユニット、統合、E2E | 16h |
| **フロントエンド実装** | タスク一覧UI、作成・編集フォーム、進捗表示 | **40h** |
| **合計** | | **106h** |

---

## 🏷️ 機能④ タグ共通者一覧機能

### フロントエンド実装状況
- ✅ プロフィールにタグ表示（完了）
- ❌ タグ検索UI（未実装）
- ❌ 共通者一覧表示（未実装）

### バックエンド実装必要項目

| 項目 | 内容 | 工数 |
|------|------|------|
| タグ検索API | タグ名での検索、部分一致対応 | 8h |
| 共通者一覧API | 同じタグを持つユーザー一覧取得、ページネーション | 10h |
| タグ統計情報 | タグ使用数、人気タグランキング | 6h |
| タグCRUD API | タグの作成、更新、削除（管理者のみ） | 8h |
| データベース設計 | Tagsテーブル、UserTagsテーブル（多対多） | 4h |
| インデックス最適化 | タグ検索の高速化 | 4h |
| テスト | ユニット、統合、E2E | 12h |
| **フロントエンド実装** | タグ検索UI、共通者一覧UI、フィルタ機能 | **28h** |
| **合計** | | **80h** |

---

## 🎨 機能⑤ チームプロジェクト画像表示

### フロントエンド実装状況
- ❌ プロジェクト一覧（未実装）
- ❌ 画像表示（未実装）

### バックエンド実装必要項目

| 項目 | 内容 | 工数 |
|------|------|------|
| プロジェクトCRUD API | 作成、取得、更新、削除 | 10h |
| 画像管理API | 曼荼羅アート画像の登録・取得 | 6h |
| プロジェクト一覧API | チームごとのプロジェクト取得、ページネーション | 6h |
| 画像アップロード | S3への画像アップロード（後フェーズ） | 0h（今回は対象外） |
| データベース設計 | Projectsテーブル、ProjectImagesテーブル | 4h |
| テスト | ユニット、統合、E2E | 10h |
| **フロントエンド実装** | プロジェクト一覧UI、画像表示UI（ギャラリー形式） | **24h** |
| **合計** | | **60h** |

---

## 📊 総合工数見積もり

| 機能 | フロントエンド | バックエンド | DB | インフラ | テスト | 合計 |
|------|----------------|--------------|-----|----------|--------|------|
| ① 認証 & プロフィール管理 | 0h (完了) | 138h | 26h | 20h | 40h | **224h** |
| ② タロット・診断 | 32h | 50h | 6h | 0h | 16h | **104h** |
| ③ タスク管理 | 40h | 50h | 6h | 0h | 16h | **106h** |
| ④ タグ共通者一覧 | 28h | 36h | 4h | 0h | 12h | **80h** |
| ⑤ チームプロジェクト画像 | 24h | 22h | 4h | 0h | 10h | **60h** |
| **合計** | **124h** | **296h** | **46h** | **20h** | **94h** | **574h** |

### 開発期間の目安

#### パターン1: フルタイム開発（1人, 8h/日）
- **約72営業日（3.6ヶ月）**

#### パターン2: パートタイム開発（1人, 4h/日）
- **約144営業日（7.2ヶ月）**

#### パターン3: チーム開発（2人, 8h/日）
- **約36営業日（1.8ヶ月）**

#### パターン4: 段階的リリース
- **フェーズ1（認証＋プロフィール）**: 224h → 約28営業日（1.4ヶ月）
- **フェーズ2（タロット＋タスク管理）**: 210h → 約26営業日（1.3ヶ月）
- **フェーズ3（タグ検索＋プロジェクト画像）**: 140h → 約18営業日（0.9ヶ月）

---

## 🎯 推奨実装順序

### フェーズ1: 基盤機能（優先度: 最高）
**期間**: 約28営業日（1.4ヶ月）  
**工数**: 224h

1. **認証システム**（68h）
   - ユーザー登録、ログイン、ログアウト
   - OAuth連携（Google優先）
   - セッション管理

2. **プロフィール管理**（70h）
   - プロフィール取得・更新API
   - 拡張フィールド（趣味、好きな食べ物、MBTI、血液型）
   - 画像アップロード（アバター、カバー）

3. **設定管理**（34h）
   - プライバシー設定
   - 通知設定
   - セキュリティ設定

4. **DB・インフラ**（46h）
   - Users, UserHobbies, UserFavoriteFoods, UserSettings テーブル
   - S3バケット設定
   - Redis設定

5. **テスト**（40h）

### フェーズ2: コア機能（優先度: 高）
**期間**: 約26営業日（1.3ヶ月）  
**工数**: 210h

1. **タロット・診断機能**（104h）
   - 診断ロジック実装
   - 結果保存・履歴
   - チーム適性診断

2. **タスク管理機能**（106h）
   - タスクCRUD
   - 進捗管理
   - 通知機能

### フェーズ3: 拡張機能（優先度: 中）
**期間**: 約18営業日（0.9ヶ月）  
**工数**: 140h

1. **タグ共通者一覧**（80h）
   - タグ検索
   - 共通者一覧
   - タグ統計

2. **チームプロジェクト画像**（60h）
   - プロジェクトCRUD
   - 画像表示（ギャラリー）

---

## 🔄 プロフィール拡充の整合性

### データ構造の統一

```typescript
// 統一されたユーザープロフィールデータ型
interface UserProfile {
  // 基本情報
  id: string;
  email: string;
  name: string;
  nickname: string;
  avatar: string;
  coverImage: string;
  bio: string;
  
  // 連絡先
  phone?: string;
  website?: string;
  location?: string;
  
  // 拡張情報（入力機能あり）
  birthday?: string;        // ISO 8601形式: "1990-01-15"
  age?: number;             // 計算値または入力値
  birthplace?: string;      // 例: "東京都渋谷区"
  hobbies: string[];        // 例: ["写真", "旅行", "料理"]
  favoriteFood: string[];   // 例: ["ラーメン", "寿司", "カレー"]
  mbtiType?: string;        // 例: "ENFP", "INTP" (16タイプ)
  bloodType?: string;       // 例: "A", "B", "O", "AB"
  
  // メタデータ
  createdAt: string;
  updatedAt: string;
}
```

### フロントエンドとバックエンドの整合性

| フロントエンド | バックエンドAPI | データベース |
|----------------|-----------------|--------------|
| ProfileEditModal.tsx<br/>（入力フォーム） | POST /api/profile<br/>PUT /api/profile/:id | Users テーブル<br/>UserHobbies テーブル<br/>UserFavoriteFoods テーブル |
| InstagramProfilePage.tsx<br/>（表示バッジ） | GET /api/profile/:id | Users, UserHobbies, UserFavoriteFoods から取得 |
| ProfileSettings.tsx<br/>（設定画面） | PUT /api/settings/privacy<br/>PUT /api/settings/notifications | UserSettings テーブル |

### タグシステムとの連携フロー

```
1. ユーザーが ProfileEditModal で趣味を入力
   例: "写真, 旅行, 料理"
   
2. フロントエンドでカンマ区切りを配列に変換
   hobbies: ["写真", "旅行", "料理"]
   
3. API リクエスト
   POST /api/profile
   { hobbies: ["写真", "旅行", "料理"] }
   
4. バックエンドで処理
   - UserHobbies テーブルに保存
   - 新しいタグは Tags テーブルに追加
   - UserTags テーブルで関連付け（多対多）
   
5. タグ検索で利用可能に
   GET /api/tags/search?q=写真
   → 「写真」タグを持つユーザー一覧を返す
```

### データ入力と表示の対応

| 入力箇所 | 表示箇所 | データ型 | バリデーション |
|----------|----------|----------|----------------|
| 誕生日（日付ピッカー） | 🎂 年齢バッジ | `birthday: string` | ISO 8601形式 |
| 出身地（テキスト） | 📍 出身地バッジ | `birthplace: string` | 最大50文字 |
| 趣味（カンマ区切り） | オレンジタグバッジ | `hobbies: string[]` | 各タグ最大20文字、最大10個 |
| 好きな食べ物（カンマ区切り） | ピンクタグバッジ | `favoriteFood: string[]` | 各タグ最大20文字、最大10個 |
| MBTIタイプ（ドロップダウン） | 🧠 MBTIバッジ | `mbtiType: string` | 16タイプから選択 |
| 血液型（ドロップダウン） | 🩸 血液型バッジ | `bloodType: string` | A, B, O, AB から選択 |

---

## 📝 備考

### 前提条件
- フロントエンドの認証・プロフィール管理機能は完成済み（約1,417行）
- モックバックエンドで動作確認済み
- バックエンドAPI、DB、インフラの構築が主な作業

### 技術スタック想定
- **フロントエンド**: Next.js 14+, TypeScript, Tailwind CSS（実装済み）
- **バックエンド**: Node.js + Express / Next.js API Routes / NestJS
- **データベース**: PostgreSQL / MySQL
- **認証**: JWT / Session-based + OAuth 2.0
- **ストレージ**: AWS S3 / Cloudflare R2
- **セッション**: Redis
- **メール**: SendGrid / AWS SES

### 工数の根拠
- 1機能 = 設計 + 実装 + テスト + ドキュメント
- バックエンドAPI: 平均8-12h/エンドポイント
- データベース設計: 3-6h/テーブル
- 統合テスト: 実装工数の20-30%

### リスク要因
- OAuth連携の複雑性（プロバイダーごとの仕様差）
- 画像アップロードの処理時間とストレージコスト
- タグシステムのスケーラビリティ（大量ユーザー時の検索速度）
- 2要素認証の実装難易度

---

## ✅ まとめ

### 総工数: **574時間**
- フロントエンド: 124h（認証・プロフィールは完了済み）
- バックエンド: 296h
- データベース: 46h
- インフラ: 20h
- テスト: 94h

### 推奨開発期間
- **フルタイム1人**: 約3.6ヶ月
- **パートタイム1人**: 約7.2ヶ月
- **チーム2人**: 約1.8ヶ月
- **段階的リリース**: フェーズ1（1.4ヶ月） → フェーズ2（1.3ヶ月） → フェーズ3（0.9ヶ月）

### プロフィール拡充の整合性
- ✅ フロントエンドの入力フォーム（ProfileEditModal）完成
- ✅ フロントエンドの表示画面（InstagramProfilePage）完成
- ✅ データ構造の統一（hobbies, favoriteFood は配列型）
- ✅ タグシステムとの連携設計（グローバルタグと同期）
- 🔄 バックエンドAPI実装（224h）が必要

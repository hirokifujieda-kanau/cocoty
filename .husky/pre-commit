#!/bin/sh
# Pre-commit Hook - ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

echo "ğŸ” ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."

# .env*ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
if git diff --cached --name-only | grep -q "^\.env"; then
  echo "âŒ ã‚¨ãƒ©ãƒ¼: .envãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚³ãƒŸãƒƒãƒˆã§ãã¾ã›ã‚“ï¼"
  echo "æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€.gitignoreã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
  exit 1
fi

# console.logã‚„console.warnãŒæ®‹ã£ã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆ.cloudignoreã‚’é™¤å¤–ï¼‰
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | grep -v -f .cloudignore 2>/dev/null || true)

if [ -n "$FILES" ]; then
  for FILE in $FILES; do
    # console.log/console.warn/console.debug ã‚’æ¤œå‡ºï¼ˆconsole.error ã¯é™¤å¤–ï¼‰
    if grep -n "console\.\(log\|warn\|debug\)" "$FILE" > /dev/null 2>&1; then
      echo "âš ï¸  è­¦å‘Š: $FILE ã« console.log/warn/debug ãŒæ®‹ã£ã¦ã„ã¾ã™"
      grep -n "console\.\(log\|warn\|debug\)" "$FILE"
    fi
  done
fi

echo "âœ… ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯å®Œäº†ï¼"
exit 0
